{% load bootstrap_icons %} {% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    {% include "header_base.html" %}
    <link rel="stylesheet" href="{% static 'results.css' %}" />
    <title>Wyniki</title>
    <script>
      if (localStorage.getItem('darkMode') === 'true') {
        document.documentElement.classList.add('dark');
      } else if (localStorage.getItem('darkMode') === 'false') {
        document.documentElement.classList.remove('dark');
      }
    </script>
    <script>
      // Whoever is working on this code, I'm sorry
      function createDiv(question, answers, correct_answer, selected_answer) {
        const letters = ['A', 'B', 'C', 'D'];
        const div = document.createElement('div');
        div.setAttribute('class', 'question');
        const text = document.createTextNode(question);
        const p = document.createElement('p');
        p.classList.add('question-text');
        p.appendChild(text);
        div.appendChild(p);
        const answersDiv = document.createElement('div');
        answersDiv.classList.add('answers');
        answers.forEach((answer, index) => {
          const answerDiv = document.createElement('div');
          const checkmarkDiv = document.createElement('div');
          checkmarkDiv.classList.add('checkmark');
          checkmarkDiv.textContent = letters[index];
          const checkColor =
            answer === selected_answer && answer === correct_answer
              ? 'var(--greener)'
              : answer === selected_answer
              ? 'var(--redder)'
              : '';
          if (answer === selected_answer) {
            checkmarkDiv.style.border = 'none';
          }
          checkmarkDiv.style.backgroundColor = checkColor;
          answerDiv.appendChild(checkmarkDiv);
          const text = document.createTextNode(answer);
          answerDiv.appendChild(text);
          const color =
            answer === correct_answer ? 'var(--green)' : 'var(--red)';
          answerDiv.style.backgroundColor =
            answer === selected_answer || answer === correct_answer
              ? color
              : '';
          answerDiv.setAttribute('class', 'answer');
          answersDiv.appendChild(answerDiv);
        });

        div.appendChild(answersDiv);

        document.body.appendChild(div);
      }

      function getData() {
        const json = `{{ results|safe }}`;
        const data = JSON.parse(json);
        console.log(data);

        if (data.msg === 'Success') {
          console.log(data.questions);
          document.getElementById('score').innerText =
            'Wynik: ' + data.score + `/${data.questions.length}`;
          document.getElementById('date').innerText = data.date;
          data.questions.forEach((question) => {
            createDiv(
              question.question,
              [
                question.answer_a,
                question.answer_b,
                question.answer_c,
                question.answer_d,
              ],
              question.correct_answer,
              question.selected_answer
            );
          });
        } else {
          document.write(data.msg);
        }
      }
      document.addEventListener('DOMContentLoaded', function () {
        getData();
      });

      function goHome() {
        const currentUrl = window.location.href;
        window.open('/', '_self');
      }
    </script>
  </head>
  <body>
    <div class="header">
      <div class="home-btn" onclick="goHome()">
        {% bs_icon 'house' size="3rem"%}
      </div>
      <div class="data">
        <h1 id="score"></h1>
        <h2 id="date"></h2>
      </div>
    </div>
  </body>
</html>
