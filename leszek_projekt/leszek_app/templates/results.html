{% load bootstrap_icons %} {% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="{% static 'results.css' %}" />
    <title>Wyniki</title>
    <script>
      // Whoever is working on this code, I'm sorry
      function createDiv(question, answers, correctanswer, selected_answer) {
        const div = document.createElement('div');
        div.setAttribute('class', 'question');
        const text = document.createTextNode(question);
        const p = document.createElement('p');
        p.classList.add('question-text');
        p.appendChild(text);
        div.appendChild(p);
        const answersDiv = document.createElement('div');
        answersDiv.classList.add('answers');
        answers.forEach((answer) => {
          const answerDiv = document.createElement('div');
          const text = document.createTextNode(answer);
          answerDiv.appendChild(text);
          const color =
            answer === correctanswer ? 'var(--green)' : 'var(--red)';
          answerDiv.style.backgroundColor =
            answer === selected_answer || answer === correctanswer ? color : '';
          answerDiv.setAttribute('class', 'answer');
          answersDiv.appendChild(answerDiv);
        });

        div.appendChild(answersDiv);

        document.body.appendChild(div);
      }

      function getData() {
        const json = `{{ results|safe }}`;
        const data = JSON.parse(json);
        if (data.msg === 'Success') {
          console.log(data.questions);
          document.getElementById('score').innerText =
            'Wynik: ' + data.score + '/40';
          document.getElementById('date').innerText = data.date;
          data.questions.forEach((question) => {
            createDiv(
              question.fields.question,
              [
                question.fields.answer_a,
                question.fields.answer_b,
                question.fields.answer_c,
                question.fields.answer_d,
              ],
              question.fields.correct_answer,
              question.fields.selected_answer
            );
          });
        } else {
          document.write(data.msg);
        }
      }
      document.addEventListener('DOMContentLoaded', function () {
        getData();
      });

      function goHome() {
        const currentUrl = window.location.href;
        window.open('/', '_self');
      }
    </script>
  </head>
  <body>
    <div class="header">
      <div class="home-btn" onclick="goHome()">
        {% bs_icon 'house' size="3rem"%}
      </div>
      <div class="data">
        <h1 id="score"></h1>
        <h2 id="date"></h2>
      </div>
    </div>
  </body>
</html>
